## 2.4 렌더링은 어떻게 일어나는가?

### 리액트의 렌더링

- 브라우저가 렌더링에 필요한 DOM 트리를 만드는 과정

- 리엑트 애플리케이션 트리 안에 있는 모든 컴포넌트들이 현재 자신들이 가지고 있는 props와 state 값을 기반으로 어떻게 UI 를 구성하고 이를 바탕으로 어떤 DOM 결과를 브라우저에 제공할 것인지 계산하는 일련의 과정

<br/>

### 리렌더링은 언제 일어나는가?

- 클래스 컴포넌트의 setState가 실행되는 경우

- 클래스 컴포넌트의 forecUpdate가 실행되는 경우

- 함수 컴포넌트의 useState()의 setter가 실행되는 경우

- 함수 컴포넌트의 useReducer()의 dispatch가 실행되는 경우

- 컴포넌트 key props가 변경되는 경우

- props가 변경되는 경우

- 부모 컴포넌트가 렌더링되는 경우

<br/>

### 렌더링 프로세스

1. 루트에서부터 아래쪽으로 내려가면서 업데이트가 필요하다고 지정된 모든 컴포넌트 탐색

2. 함수형 컴포넌트의 경우 FuntionComponent()를 호출한 뒤 결과물 저장

3. 렌더링 결과물은 JSX로 구성되어 있고 JS로 컴파일되면서 React.createElement() 호출 구문으로 변환

4. `{type: TestComponent, props: {a: 35, b: 'test', children: '안녕'}}`

5. 결과물 수집 후 가상 DOM과 비교해 실제 DOM에 반영하기 위한 `재조정(Reconciliation)` 과정 실행

6. 재조정이 끝나면 하나의 동기 시퀀스로 DOM에 적용해 결과물 노출

<br/>

### 렌더와 커밋

리액트의 렌더링은 렌더 단계과 커밋 단계라는 총 두 단계로 분리되어 실행된다.

**렌더 단계 (Render Phase)**

- 컴포넌트를 렌더링하고 변경 사항을 계산하는 모든 작업

- 컴포넌트를 실행해 이 결과와 이전 가상 DOM과 비교하는 과정을 거쳐 변경이 필요한 컴포넌트 체크하는 단게

  - 비교하는 것: `type`, `props`, `key`
  - 셋 중 하나라도 변경된다면, 변경이 필요한 컴포넌트로 체크한다.

<br/>

**커밋 단계 (Commit Phase)**

- 렌더 단계의 변경 사항을 실제 DOM에 적용해 사용자에게 보여주는 과정

<br/>

**렌더링이 일어난다고 해서 무조건 DOM 업데이트가 일어나지 않는다.**

렌더 단계에서 변경 사항이 감지되지 않으면 커밋 단계는 생략 가능

=> 브라우저의 DOM 업데이트 또한 일어나지 않는다.

리액트 18에서는 동시성 렌더링 도입

동시성 렌더링은 렌더링 중 렌더 단계가 비동기로 작동해 특정 렌더링의 우선순위를 낮추거나, 필요하다면 중단하거나 재시작하거나, 경우에 따라서는 포기할 수도 있다.
