### 4.3.1 Next.js란?

풀스택 웹 애플리케이션을 구축하기 위한 리액트 기반 프레임워크다. 리액트 기반 프로젝트에서 서버사이드를 염두에 두고 있다면 Next.js를 선택하는 것은 합리적인 선택이다.

### 4.3.2. Next.js 시작하기

create-next-app을 기반으로 Next.js 애플리케이션을 생성할 수 있다.

```bash
npx create-next-app@latest --ts
```

`package.json`

```json
{
  "scripts": {
    "dev": "next dev",
    "build": "next build",
    "start": "next start"
  },
  "dependencies" : {
    "next": "^11.1.2",
    "react": "^17.0.2",
    "react-dom": "^17.0.2"
  },
  "devDependencies": {
    ...
    "@types/react": "^17.0.33",
    "@types/react-dom": "^17.0.10",
    "typescript": "^4.4.3"
  }
}
```

- next : Next.js의 기반이 되는 패키지
- eslint-config-next: Next.js 기반 프로젝트에서 사용하는 ESLint 설정

`next.config.js`

```js
/** @type {import('next').NextConfig} */
const nextConfig = {
  reactStrictMode: true,
  swcMinify: true,
};

module.exports = nextConfig;
```

- @type는 js 파일에서 타입스크립트의 도움을 받기 위해 추가된 코드다.
- reactStrictMode는 Next.js에서 리액트의 StrictMode를 사용할지 여부를 결정한다.
- swcMinify는 Vercel에서 만든 SWC를 이용하여 번들링과 컴파일을 더 빠르게 수행하게 도와준다.
  - 바벨의 대안으로 볼 수 있으며 js로 만들어진 바벨과는 다르게 러스트라는 완전히 다른 컴파일 언어로 작성해 빠르고 병렬로 작업을 처리한다.

`pages/_app.tsx`

페이지의 시작점으로 웹 애플리케이션에서 공통으로 설정해야 하는 것들을 여기에서 실행할 수 있다.

다음과 같은 일들을 수행할 수 있다.

- 에러 바운더리를 사용해 애플리케이션 전역에서 발생하는 에러 처리
- reset.css 같은 전역 CSS 선언
- 모든 페이지에 공통으로 사용 또는 제공해야 하는 데이터 제공

`pages/_document.tsx`

\_app.tsx가 애플리케이션 페이지 전체를 초기화하는 곳이라면, \_document.tsx는 애플리케이션의 HTML을 초기화하는 곳이다.

- <html>이나 <body>에 DOM 속성을 추가하거나 변경할 수 있다.
- \_app.tsx는 렌더링이나 라우팅에 따라 서버나 클라이언트에서 실행될 수 있지만 \_document는 무조건 서버에서 실행된다.
- Nest.js에는 두 가지 <head>가 존재한다. next/head와 next/document로 next/document의 head는 \_document에서만 사용할 수 있다.
- CSS-in-JS의 스타일을 서버에서 모아 HTML로 제공하는 것도 가능하다.

정리하자면 \_app.tsx는 Nest.js를 초기화하는 파일로 Next.js 설정과 관련된 코드를 모아두는 곳이다. 경우에 따라 서버와 클라이언트 모두에서 렌더링될 수 있다.
\_document.tsx는 Next.js로 만드는 웹사이트의 뼈대가 되는 HTML 설정과 관련된 코드를 추가하는 곳이며, 반드시 서버에서만 렌더링된다.

`pages/_error.tsx`

클라이언트에서 발생하는 에러 또는 서버에서 발생하는 500 에러를 처리할 목적으로 만들어졌다. Next.js 프로젝트 전역에서 발생하는 에러를 적절하게 처리하고 싶다면 \_error.tsx를 사용하면 된다.

`pages/404.tsx`

404 페이지를 정의할 수 있는 파일이다. Next.js에서는 404 페이지를 직접 정의할 수 있다.

`pages/500.tsx`

서버에서 발생하는 에러를 핸들링하는 페이지다. \_error.tsx와 500.tsx가 모두 있다면 500.tsx가 우선적으로 실행된다.

`pages/index.tsx`

Next.js의 라우팅 구조는 /pages 디렉터리를 기초로 구성되며, 각 페이지에 있는 default export로 내보낸 함수가 해당 페이지의 루트 컴포넌트가 된다.

- /pages/index.tsx : /
- /pages/about.tsx : /about
- /pages/users/index.tsx와 /pages/users.tsx는 같은 주소로 접근할 수 있다.
- /pages/users/[id].tsx : []를 사용해 동적 라우팅을 구현할 수 있다.

`서버 라우팅과 클라이언트 라우팅의 차이`

Next.js는 서버 사이드 렌더링을 수행하지만 동시에 싱글 페이지 애플리케이션과 같이 클라이언트 라우팅 또한 수행한다.

next/link에서 제공하는 Link 컴포넌트를 사용하면 클라이언트 라우팅을 수행할 수 있다.

Next.js는 서버 사이드 렌더링의 장점, 즉 사용자가 빠르게 볼 수 있는 최초 페이지를 제공한다는 점과 싱글 페이지 애플리케이션의 장점인 자연스러운 라우팅이라는 두 가지 장점을 모두 가지고 있다.

`클라이언트 라우팅을 수행하기 위한 규칙`

- <a> 대신 <Link>를 사용한다.
- window.location.push 대신 router.push를 사용한다.
